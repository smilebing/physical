<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>斜坡实验</title>
    <link href="https://cdn.bootcss.com/twitter-bootstrap/3.4.1/css/bootstrap.css" rel="stylesheet">
    <script src="js/matter.js" type="text/javascript"></script>
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>
    <script src="https://cdn.bootcss.com/twitter-bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>
<body>

<!--<button class="glyphicon glyphicon-chevron-left"/>-->
<!--<button class="glyphicon glyphicon-chevron-right"/>-->
<div>
    <h1 align="center">摩擦力实验</h1>
</div>
<div id="sim" align="center"></div>
<div align="center">
    <button class="btn btn-primary">改变摩擦力</button>
    <button class="btn btn-success">改变质量</button>
    <button class="btn btn-info">改变接触面积</button>
</div>
</body>

<script>
    // module aliases
    var Engine = Matter.Engine,
        Render = Matter.Render,
        World = Matter.World,
        Bodies = Matter.Bodies,
        Mouse = Matter.Mouse,
        MouseConstraint = Matter.MouseConstraint,
        World = Matter.World,
        Composites = Matter.Composites,
        Render = Matter.Render,
        Runner = Matter.Runner,
        Vector = Matter.Vector;


    // create an engine
    var engine = Engine.create();

    // create a renderer
    var render = Render.create({
        element: document.getElementById("sim"),
        engine: engine,
        options: {
            width: 800,
            height: 600,
            showVelocity: true
        }
    });


    Render.run(render);

    // create runner
    var runner = Runner.create();
    Runner.run(runner, engine);

    World.add(engine.world, [
        Bodies.rectangle(400, 0, 800, 5, {isStatic: true}),
        Bodies.rectangle(400, 600, 800, 5, {isStatic: true}),
        Bodies.rectangle(800, 300, 5, 600, {isStatic: true}),
        Bodies.rectangle(0, 300, 5, 600, {isStatic: true})]
    );

    // add mouse control
    var mouse = Mouse.create(render.canvas),
        mouseConstraint = MouseConstraint.create(engine, {
            mouse: mouse,
            constraint: {
                stiffness: 0.2,
                render: {
                    visible: true
                }
            }
        });

    World.add(engine.world, mouseConstraint);

    var du = Math.PI * 0.4;
    var stickA = Bodies.rectangle(400, 400, 20, 600, {
        isStatic: true,
        angle: -du
    });
    var stickB = Bodies.rectangle(400, 150, 20, 600, {
        isStatic: true,
        angle: -du
    });
    World.add(engine.world, [stickA, stickB]);

    var g = 10;

    //两个物体的质量，g
    var mA = 100;
    var mB = 1;

    var densityA = 0.1;
    var densityB = 1;

    var frictionA = 1;
    var frictionB = 1;

    var vSin = Math.round(Math.sin((du)) * 1000000) / 1000000;

    //余弦值
    var vCos = Math.round(Math.cos((du)) * 1000000) / 1000000;

    //计算摩擦力
    //滑动力
    // Fhua=mg*sin(du)
    //摩擦力
    // Fmo=mg*cos(du)
    // 真正运动的力
    //Fdong=Fhua-Fmo=mg*sin(du)-mg*0.5*cos(du))

    var fA = mA * g * vSin - mA * g * 0.5 * vCos;
    var fB = mB * g * vSin - mB * g * 0.5 * vCos;

    console.log(fA);
    console.log(fB);

    if (fA > 0) {
        //能滑动
        //计算摩擦系数
        frictionA = 1 / fA * 100;
    }

    if (fB > 0) {
        //能滑动
        //计算摩擦系数
        frictionB = 1 / fB * 100;
    }

    console.log(frictionA);
    console.log(frictionB);

    var rectA = Bodies.rectangle(200, 320, 50, 50, {
        friction: frictionA,
        density: densityA
    });
    var rectB = Bodies.rectangle(200, 30, 50, 50, {
        friction: frictionB,
        density: densityB
    });

    // 将刚体添加到世界中
    World.add(engine.world, [rectA, rectB]);

</script>
</html>